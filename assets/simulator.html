<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class=" ckmargxoy idc0_348"><head>
<link rel="icon" data-savepage-href="http://davesrocketworks.com/favicon.ico" href="data:image/vnd.microsoft.icon;base64,AAABAAEAQEAAAAAAAAAoFgAAFgAAACgAAABAAAAAgAAAAAEACAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////ABJk/QCVjIoALDV1AIrH9wBbhNIAyMi/AC1UugBeZm8AKiQzAC2i/ACNqscAzuj3AGye+wBebaAANXPjABM5ogA+U4oAtcrsAKyrrQBZUFAAQnW8AEc1PgCInOcAhpWnADIpVgAkgv8AdXiLAK24ywDR1tsAFGTeAFiH+QB3lskA6e/0AB9CigBrg7oAT3LqACxozAAnQVcAMmn7AHqy6QCltucAOUlrAJLf+QBwguAARZf7AJqdnABCXcEALF7hAFJTcgAjSKsAl6vbAH6IlgBWZI8A1Pv9AG1yeQC5xtQAGDJ3AIqz9QC7vLYAbpTqAEpy1wDd5OsATme3AJqougAUdvsA09XtAFqZ+QAeVegAOnn5ADk1SQCNmcwAITWYADVTmQBUdckAMkeHADU4ZwB8psoAJ0SbACVLxQCttbsAiMfnAMTN5wAmLmgAxdDSACRq9ACTqeoALCdIAEl2+ACbpakAYovnAKrF0wAZV/wAs7XYAIGo8QCIhogANmXWACp1/gCbrscAo7XZAB9j5wCWjZgA8vv8AMW/yQA4R3sAOKj4AEpYjAA5WrgAVn/dADYmNwBniNQAiZKbAHei9gAzU68ANzt1ADsyPQAmKlMAqs/sALu9wgBzrPEAZZX4AIyn3ABALEsAKmbrABxr/AAyY8QA2d/iAMvKywAoQ4QANZv6ALrFyQDl6+sAdXh8ADt26wDJ1uYAZWloADNr6gAxL2oAIDiIAHiW6QAde/0AM0ySAKWuxwCkqLIALFrYACxXwwA2bvQAKi1bAJHJ6QCztsQANDJXAMHCvQApa/wAlJyjAEVWhQAoZNwAO5X8AIan6gCOk5QAtL3LAKKlpAAuc94ArbKzACwxYwCLj6oAb25yAMzT1QAyLEoAHXP8AEExQgAfLGsAtbu7ABdy9QAwY+UALDRsAIiLmQDCvrYAGWT7ACxGiwArgv0AxMjFALS60wCcoqMAa5T1AJGUmgDEy8sAIlrqADVq2gCqsawAoqesAK660QAjbP0AJHT9ALK1tQCpttoAM6D9AKu1xgAzatQANHTdAMPFywC8vbwAHoH/ACN8/wCUlJQAur3LALi3tQCXnagA2OToAKqtswA8L0QAGmn3ACwsVgC1u8MALHr9AJSMkwDl7PIAvcLCAJ612wDIz9YADWT8AMLDwgClq60A6fP3ANXc4gC1yvEAwL7CANPa3QDIxscA2+LlAM3U2gAVev0AoammACYsXAC8wLcA0NbXAMXM0wDIycMAwb68ALS3uwC+wL4AKGfoALW5tgDj6e0APTJDAODl7AC9xMoAm6KqAP/+/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+Gc3diRrMnCD8qzwrO+jrKysd8nJye/Jyck878nJycnJ8sk87++syazJPMnJrKysycnJPMnJyazJyTys8KzwrGdnN1KVHJsrNYOsrO+s1dXF76ys78nJycnvycnvycmsrMnJycnJycnwrPCsrDw8ycnJycnJ78nJyazJyazwPMmH3zcFTr82KytauqOs1aC2oOzsrMnJrO/J7+/Jye/J7zzJ8qzvye/JPPCsrPDJrMnJycnJycnvd8nJyazJrPDZHVx2BXghxQkrK3D2rNXNgzng4Hc8ycnJycnyycnOycnJrMnJycnJrKzw8PCsPMnJrMnJPMnJycnJyXfJyfA8rPagv2MpKQzNCU0ncM3vHVw54OB3rKzvPMnvrMmsyazJ78nJ78nJycms8Dw8rPA8rMnJycnJ78nJycnJyfDJrMl3d/bNY1JSTs0yOmwhQcW/OeAed8nJycnJycmsrDzJycnJycnJ78ms8Kys8PCs8PCsPMmsycnJycnJycmsPMnJd3fVd91jUiwhNkuRkW9jtlPg5snJycnv7+/Jyck8ycnJycnJycnJyfA8yaw8rPCsyTzyycnJd8nJycnJyck8rHd31cl31WNSFkBXW0XxBmSHh1XJycnJyck8yaysyTysye/J78nvycmsrPDwrPA8PMnJycmsycmsPMnJycnJPMl31XfV1dmlMx9GPSoYRbs+2vXI76zJye/JrMmsycmsycnJyaysyfDwPPCs8MnJycnJyazJPDzJrMnw8KzwrKzwd8msrKxRGUvT3NOMUy27u09Bh+/JycnvyTzJyazJycnVycnJycmsrPCs8KysycnJycnJycnJycnJyTzw8PCs8Kys7+/VQY/aiQIC018Trl3xSfeD7+/JyazJrMnJyazJycnJrKzJycms8DysrMnJycnJycnJycnJycnJPPA88PDJ76w84khIHRi7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PMnwrPCs8Mnwycnuyd3DbYyHp+vj4x4e69vrwqHdycmYycnJycnuye7J3eLi7jysrPCs8MnwyTzJycnJycnJycnJPMk8ycnJycnJycnJ7qD32YfmHuMe4x4ep+u+od3JycnJycnJyd3iydl37nes8PA8rPDwrMnJycnJycnJye7JycnJycnJ7snuye7J7snuybfZ4+bj4ODg4+vj6y+jmDzJmHeYd8nJmHfumMnu8Kzw8MnJPKzJycnwycnJd3fJ7snJPMnJycnuycnuycnJyeLJL3fl6+Pj4OM/uuzroTzdyXfJycnwd8mY3cmYd6zwPKw8rPDJrMnwycnJycnJycnJ8MnwyfDJyfDJycnJycnu7t23d+Dj4OPYUTjs4KehPMnJycl34pju4uLJ4u7JycnJrPDJycnJ7snJycms8MnJycnJ8MnwrPA8ycnJycnJye7JmL6j5eMio4Xj5ePjVS883cnJ8NnumHfJd8nZ8MmsycnJycnJycnJycnJycnJyfDJyazJ8KzwPPDwycnJmMnwycntFO8/LzjjhOV/4+DshcLdydnJyeLu2ZjJ7qzJrMnJycnJyTzJyTzJycnJycnJ8PDJyfDw8Kw88JjJycnJycnwybW9OGB/5eU/0H/1msxg0YA8yfDu2cndd92s8HfJycnJ8MnJycnJyTw8rMnwycnJycms8Mnw8KzJycnumMmYyfDJmOij4+XlPz/YuZoid6be9vDdyd134snJrKzwPMnJd8nJyfCs8PDJycnJ7u7JycmsycnJd/DJycnuycnJ7vCYyZjkrKGn0PUiuRQi5eUUCaPkmMni3e7d3fDw8DzJye7J8Mk88PCsPPDJycnJycl3ycnJycnwyfDJyfDJycnwycnJPNl3vqf1udHf9eXl48yIyXfd3cni3XfwrKzwycnJycnwrPDJyfDJ8MnwycnJycnJycnJyfDw8MnJ7snJyZjJycnJ8N2+HJbfP/OE5eWnn6zw8MnJ7ph38PCs8MnJyck88MnJmMnJ7snJycnJycnJycnu8MnJ8MnJ8PDJyZjJycmY8MmYyc7J49jz2PPg0N086vB32XeY7qzw8PCsycnJyfDwycnwycnJ7snJ7nfJycnuycnJ7snJ8JjJmN3wye7uycndPPC1PMLs2NjfP+M/HdWY8O6Y4tms8MnwycnJycnJ8PDJyfDJyZjJmJiYycnJycmYycnwye7JyfDJyZjJycnwycnw8PDk3vYi2NjzDV96g/DiyfDwrDzwrMnJycnwycnJycnJycnJycnJycmYmMnJycnJ8MnJ8MnwycmYycnu7snJ8Mnwyd3Jd9BnDXiCRL+YyfDw8PDwrMnJ8Mk8ycnJyfDwycnJ7snJmMnJycnJ7smYycnJycnJ7u7wycmY2cmYyfDw8PDJ3dmW4XiCxJ1x1erwd8nJycmsycnJycnJ8DzwyfDJmMnJ8Mnuye7JycnuycnJye7JycnJ8MnJmMnJ4snJmMnw8O7u9ldEC2rEgp7Z8O7JycnJycl3ycnJ7sk88MnuycnJ8MnJycnJyd3JyfDJmO7wye7JmMnuycnuyZjJmMnJycnJmMnIKkSdCwtEtvDJ7snJd8nJycl3ycnZ8O7Jycnuye7wycnwmJjJycnJ7vDwycnJmJjJycnJ8MmYydnumPDJyfDu7uLDXy4Lgp7ZmJjJycnJyXfJd3fuycnJycnwycnJyZjJ7snu8JjJyZjwycnuycnJ7snwmMnwycmYmMnJ7smYydnu4tkqDi4u2u7JycnJycnJycnJ4snJ7snJyfDuyfDu8MnJ2cmYycnJye6YycnJycnJmMndycnJyfDJmJjJmMnu3cnJ4rZXRD3NycnJ7snJscnJycnw7snJmMnJmPDJyfDwmMnumMnJ7vDwycmYmJjJyeKYycnu7snu3Zh38MmY7pjJyfA89sNXXu7wycnJycnJye7JyfDJycnJ8MnJycnwmMnu2cnw8PDdycnu4smYycmYye6YyZjJyfCYd8nw2cnu8HeY8MmYaHeYyZjJycmYye7JycmYye7J8PDJmO7J8MnJye7J8MmYycndycmYycmYycndycndyZjJyZjJ7smYycmYyTzJye7uPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">
<meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
<meta http-equiv="Content-type" content="text/html; charset=us-ascii">
<meta http-equiv="Content-Language" content="en-us">
<title>CP/M-68K Simulator</title>
<meta name="description" content="CP/M-68K, computer system and software">
<meta name="keywords" content="CP/M-68K, MC68000, simulator">
<style data-savepage-href="/mystyle.css" type="text/css">* {margin:0; padding:0;}
body {
  font-family: Helvetica, Geneva, Arial,
        SunSans-Regular, sans-serif;
  color: black;
  background-color: #00ffff;
  margin: 1em }
p { 
  margin: 0.5em 0.5em
}
blockquote {
  width: 80%;
  margin-left: 3em;
  background-color: #00f0f0
   }

ul, ol {
  margin-left: 6em }


h1 {
  font-family: Georgia, "Times New Roman",
        Times, serif;
  text-align: center;
  margin-bottom: 0em }
a:link {
  color: blue }
a:visited {
  color: purple }
address {
  margin-top: 1em;
  padding-top: 1em;
  border-top: thin dotted }

table.citation {
    margin-left: auto;
    margin-right: auto;
    width: 80%;
    border-width: thin;
    border-style: solid }

ol.decimal { list-style-type: decimal }
ol.alpha  { list-style-type: lower-alpha }
ol.ualpha { list-style-type: upper-alpha }
ol.roman  { list-style-type: lower-roman }

img.float-left { float: left }

</style>

<style id="savepage-cssvariables">
  :root {
  }
</style>
<script id="savepage-shadowloader" type="text/javascript">
  "use strict";
  window.addEventListener("DOMContentLoaded",
  function(event) {
    savepage_ShadowLoader(5);
  },false);
  function savepage_ShadowLoader(c){createShadowDOMs(0,document.documentElement);function createShadowDOMs(a,b){var i;if(b.localName=="iframe"||b.localName=="frame"){if(a<c){try{if(b.contentDocument.documentElement!=null){createShadowDOMs(a+1,b.contentDocument.documentElement)}}catch(e){}}}else{if(b.children.length>=1&&b.children[0].localName=="template"&&b.children[0].hasAttribute("data-savepage-shadowroot")){b.attachShadow({mode:"open"}).appendChild(b.children[0].content);b.removeChild(b.children[0]);for(i=0;i<b.shadowRoot.children.length;i++)if(b.shadowRoot.children[i]!=null)createShadowDOMs(a,b.shadowRoot.children[i])}for(i=0;i<b.children.length;i++)if(b.children[i]!=null)createShadowDOMs(a,b.children[i])}}}
</script>
<meta name="savepage-url" content="http://davesrocketworks.com/electronics/cpm68/simulator.html">
<meta name="savepage-title" content="CP/M-68K Simulator">
<meta name="savepage-pubdate" content="Unknown">
<meta name="savepage-from" content="http://davesrocketworks.com/electronics/cpm68/simulator.html">
<meta name="savepage-date" content="Wed Sep 13 2023 23:17:12 GMT+0200 (Central European Summer Time)">
<meta name="savepage-state" content="Standard Items; Retain cross-origin frames; Merge CSS images; Remove unsaved URLs; Load lazy images in existing content; Max frame depth = 5; Max resource size = 50MB; Max resource time = 10s;">
<meta name="savepage-version" content="33.9">
<meta name="savepage-comments" content="">
  </head>
<body>
<h1>CP/M-68K Simulator</h1>
<p>This is a work in progress but might be good enough for others
to play with.</p>
<p>This is built on the framework provided by the <a href="http://www.zophar.net/linux/68000/musashi.html">Musashi</a>
MC68000 simulator. In addition to simulating a MC68000 the only
hardware simulated is a console port and the disk system. The code,
and especially the console I/O assumes it is running under
Linux.</p>
<p>To build the simulator for CP/M-68K you will need a copy of the
code above and this. The file cpmsim.c is the simulator and used
the example.c program as a skeleton on which to build. Build using
the makefile supplied along with cpmsim.c. This should create an
executable named "cpmsim".</p>
<h2>Console</h2>
<p>The console port is a very simple simulation of a serial port.
In this case a much reduced 6850 ACIA. While I have included code
for interrupts, I haven't tested them. Standard input and output
are switched to raw mode so that things like control-C can be
handled by CP/M. The settings are restored on exit but if the
signal handler doesn't get called, this will not happen.</p>
<h2>Disks</h2>
<p>The simulator provides for up to 16 simulated disk systems. You
can mount a file as a simulated CP/M disk with the command line
option of "-a filename" where "a" can be anything between "a" and
"p". The simulator determines the size of the attached files when
mounted and will not attempt to read or write beyond that
limit.</p>
<p>Drive C is attached to the file "diskc.cpm.fs" which is a 16MB
file system and is included in this package. The image included
contains a complete working CP/M-68K system. 16MB is much less than
the 512MB maximum for CP/M-68K but seemed like a workable size. Big
enough to hold all the tools and several projects. If you need
more...</p>
<p>Drive A simulates a plain vanilla 8" SS SD drive. This is handy
for moving files into and out of the simulation using cpmtools.
  This is the default for cpmtools. I also included a 800K drive B which is what my CP/M-68K system used. </p>
<p>If you add <a data-savepage-href="diskdef.txt" href="http://davesrocketworks.com/electronics/cpm68/diskdef.txt">this</a> to your diskdefs file you can access the C drive image using cpmtools. But be careful, do not alter an image that is in use as CP/M-68K can't tell that something has changed. With the A drive you just do a CTRL-C and it relogs the drive. Drive C has no check vector as it is supposed to look like a fixed disk.</p>
<p>Although it isn't much faster, drive M is a 16MB ram disk. I
measured a long compile to be about twice as fast when run from the
ram disk. Probably not worth the effort.</p>
<p>Other drives of different sizes can be added by including the
appropriate changes in the BIOS. Creating a new file system image
is as easy as using the Unix tool "dd".</p>
<p>If by some chance you run two instances of the simulator at the
same time that mount the same file system images, only the first
will be able to write to them. The second will inform you when an
image is mounted read only.</p>
<h2>Booting</h2>
<p>There are two options for booting CP/M-68K. From binary images
or from the drive C file system.</p>
<h3>Binary images</h3>
<p>The CP/M-68K distribution provides for a way to bring it up
without the tools included. An image of the BDOS in S-record format
is included. By loading this along with a rudimentory BIOS at a
fixed address you can get things started. This is how I started
here. By including the option "-s" on the commaned line the
simulator will load the BDOS from "cpm400.bin" and the BIOS from
"simbios.bin".</p>
<p>While most of the programs in user area 0 of the drive C file system were relocated using this boot option, some were not. This will result in those programs  not loading. If this happens you will have to dig up the relocatable version. I don't expect this to be a big problem because there is really no reason to boot this way.</p>
<h3>Drive C</h3>
<p>This replicates the normal multi-stage boot process. The CP/M
loader is located in the system portion of the drive C file system
and is loaded into memory and executed. It locates CPM.SYS on the
file system and loads that into memory.</p>
<p>You can make changes to CP/M using the available tools (C
compiler, assembler, linker) creating a new CPM.SYS. Just be sure
to keep backups. The source for the provided system is in user area
2.</p>
<h2>Exiting</h2>
<p>Ending the simulation is as easy as typing "bbye" which signals
the simulator to wrap things up. The terminal is set to raw mode so
^C doesn't work. That gets passed through so that CP/M-68K can
handle it.</p>
<h2>Extras</h2>
<p>I have included a few things that are not a part of the standard
distribution:</p>
<table>
<tbody><tr>
<th>User</th>
<th>Contents</th>
</tr>
<tr>
<td>14</td>
<td>uemacs V3.6.1</td>
</tr>
<tr>
<td>13</td>
<td>uemacs V?</td>
</tr>
<tr>
<td>11</td>
<td>CC</td>
</tr>
<tr>
<td>10</td>
<td>make</td>
</tr>
<tr>
<td>9</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>Another version of make</td>
</tr>
<tr>
<td>6</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td>loader and regular BIOS, etc</td>
</tr>
<tr>
<td>4</td>
<td>CP/M loader lib source</td>
</tr>
<tr>
<td>3</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>C libraries</td>
</tr>
<tr>
<td>1</td>
<td>C include files</td>
</tr>
</tbody></table>
<h3>Micro-emacs</h3>
<p>Ed is usable as a text editor but that isn't saying much. A
screen editor is much betters and micro-emacs fits the bill. Two
versions are provided. The first is of unknown vintage as I can't
find any indication of a version number. This is named "emacs". The
second is built from the version 3.6.1 sources and is named
"uemacs". The 3.6.1 version has key bindings more like what I am
used to. Both use ANSI escape codes and work well for me in an
xterm.</p>
<h3>cc</h3>
<p>Compiling C programs using the provided submit files, which
can't be nested, is tedious at best. This program makes it more
like the usual process in Unix. Compiling something like
micro-emacs as easy as "cc *.c -o emacs.rel". This program comes in
two parts. The first part is cc.68k and it loads the second part
into the high part of the TPA. It then changes the TPA size before
starting that program. This lets CC load and run other
programs that have been converted from relocatable form using reloc.</p>
<h3>make</h3>
<p>The version in  user 0 just creates a submit file and is built from the source in user area 7. I finally located this source which was hiding in a .arc file. This code uses one of the attribute bits to test if a file has changed. Not nearly as good as a real time stamp but usable. The source in user 10
is for something better although it requires more work to port from its MSDOS origins.</p>
<h3>whereis</h3>
<p>Locating a file somewhere in the user areas can be a pain so
this program lets you specify a filename with optional wildcards
and it prints out a list of aveerything that matches.</p>
<h3>split</h3>
<p>For those times when you need to burn EPROMS and need to split a
binary into the even and odd parts. Checks for a CP/M-68K
executable file header and skips it if found.</p>
<p>Not all of the files from the CP/M-68K distribution are here.
Just what made it over while I was working on this.</p>
<h2>Changing things</h2>
<p>Besides changes to the BIOS you can also change CP/M-68K. One
thing I did long ago was add improved command line editing. I had a
chance to use a CPM+ system once and liked that a lot. My new
readline function is part of the included CPMLIB. Souce is in
newcon.c with documentation in newcon.doc. This function is
available via the BDOS call as well.</p>
<p>Other modules can be swapped out of CPMLIB using ar68. Changes
are a lot easier now with the original source code available.</p>
<p>If you break it just dig out your backup of the disk C image and
start again.</p>
<h2>The Code</h2>
<p><a data-savepage-href="cpmsim.zip" href="http://davesrocketworks.com/electronics/cpm68/cpmsim.zip">CP/M-68K Simulator</a></p>
<p>Unzip the Musashi source first and run it through dos2unix or it will not compile. At least it wouldn't for me. Then unzip my file and be sure to use the m68kconf.h file in it. Then run make.</p>
<h3>2017 Addenda</h3>
<p>I received a report of segmentation violations when built using V3.4 of the Mushashi source. (I used 3.3) Upon investigation I found a thinly documented change to the initialization code. The README doesn't say anything but the example added some new code. So if you use V3.4 you need to add this just before the call to m68k_pulse_reset() in cpmsim.c:</p>
<pre>m68k_init();
m68k_set_cpu_type(M68K_CPU_TYPE_68000);
</pre>
<h3>December 2020</h3>
<p>A report of a compilation failure. A check shows that the Musashi readme is up to version 4.10 but the history file hasn't been updated since 3.4 so tracking changes is difficult. (I am not going to poke around the git commit comments!) But the code was reorganized which broke my makefile. Instead of breaking out the code it generates into four files it now uses one. It has also added a pile of software floating point code. Which is pretty useless  for simulating something that doesn't want or need the MC68881 floating point coprocessor. There ought to be a '#if USE_MC68881' somewhere at least.</p>
<p> So use the 3.4 version if you can or update the makefile as needed.</p>


<a data-savepage-href="http://davesrocketworks.com" href="http://davesrocketworks.com/">Home</a>


</body></html>